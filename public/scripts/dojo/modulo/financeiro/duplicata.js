/*
	Copyright (c) 2004-2010, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["modulo.financeiro.duplicata"]){dojo._hasResource["modulo.financeiro.duplicata"]=true;dojo.require("modulo.padrao.geral");dojo.require("modulo.padrao.grid");dojo.provide("modulo.financeiro.duplicata");dojo.declare("modulo.financeiro.duplicata",[modulo.padrao.geral,modulo.padrao.grid],{constructor:function(){},initGrid:function(){objGeral.loading(true);financeiroDuplicata.gridHeader="#,"+objGeral.translate("Data")+","+objGeral.translate("Terceiro")+","+objGeral.translate("Documento Fiscal")+","+objGeral.translate("Situação")+","+objGeral.translate("Parcelas")+","+objGeral.translate("Tipo")+","+objGeral.translate("Valor");document.getElementById("gridFinanceiroDuplicata").style.height=objGrid.gridHeight+"px";financeiroDuplicata.grid=new dhtmlXGridObject("gridFinanceiroDuplicata");financeiroDuplicata.grid.setHeader(financeiroDuplicata.gridHeader);financeiroDuplicata.grid.attachHeader("#rspan,#text_filter,#text_filter,#text_filter,#text_filter,#text_filter,#select_filter,#text_filter");financeiroDuplicata.grid.setInitWidths(objGrid.idWidth+",90,*,300,120,80,120,200");financeiroDuplicata.grid.setColAlign("center,center,left,left,left,center,left,left");financeiroDuplicata.grid.setColTypes("ro,ro,ro,ro,ro,ro,ro,ro");financeiroDuplicata.grid.setColSorting("str,date,str,str,str,str,str,na");financeiroDuplicata.grid.setSkin(objGrid.theme);financeiroDuplicata.grid.enablePaging(true,objGrid.pagResults,objGrid.pagIndexes,"divpagFinanceiroDuplicataGrid",true,"divpagFinanceiroDuplicata");financeiroDuplicata.grid.attachFooter(objGeral.translate("Registros")+",#cspan,#cspan,#cspan,#cspan,{#stat_count},"+objGeral.translate("Total R$")+",{#stat_total}");financeiroDuplicata.grid.attachEvent("onRowDblClicked",financeiroDuplicata.edit);financeiroDuplicata.grid.init();financeiroDuplicata.grid.load(baseUrl+"/financeiro/duplicata/list",dojo.hitch(objGeral,"loading",false),"json");},novo:function(){objGeral.createDialog("/financeiro/duplicata/form/",objGeral.translate("Duplicata"));},edit:function(){if(!financeiroDuplicata.grid.getSelectedId()){objGeral.msgAlerta(objGeral.translate("Selecione o item para edi&ccedil;&atilde;o."));return false;}objGeral.createDialog("/financeiro/duplicata/edit/id/"+financeiroDuplicata.grid.getSelectedId(),objGeral.translate("Duplicata"));return true;},atualizarGrid:function(){objGeral.atualizarGrids([financeiroDuplicata.grid]);},geraPacelamento:function(){var _1=dijit.byId("fn_duplicata_total").attr("value");var _2=dijit.byId("fn_duplicata_parcelas").attr("value");var _3=dojo.date.stamp.fromISOString(dojo.byId("fn_duplicata_data").value);objGeral.loading(true);var _4=_1/_2;_4=_4.toFixed(2);var _5=parseFloat(_4);var _6=(_1-(_5*_2))+_5;this.addPacelaDuplicata("",null,0);objGeral.deleteRow("#tbl-parcelas-duplicata tr");if(_2>72){objGeral.loading(false);objGeral.msgAlerta(objGeral.translate("Limite de parcelas atingido."));return false;}for(i=1;i<=_2;i++){_3=dojo.date.add(_3,"day",30);if(i==1){this.addPacelaDuplicata(i+"/"+_2,_3,_6);}else{this.addPacelaDuplicata(i+"/"+_2,_3,_4);}}objGeral.loading(false);},addPacelaDuplicata:function(_7,_8,_9){var _a=$("<td />");var _b=$("<td />");var _c=$("<td />");var _d=$("<td />");var tr=$("<tr />");var _e=_7;var _f=new dijit.form.DateTextBox({name:"fn_lancamento_data[]",required:true,value:_8});var _10=new dijit.form.CurrencyTextBox({name:"fn_lancamento_valor[]",required:true,constraints:{min:1},currency:"R$ ",value:parseFloat(_9)});var _11="-";_a.append(_e);_b.append(_f.domNode);_c.append(_10.domNode);_d.append(_11);tr.append(_a).append(_b).append(_c).append(_d);$("#tbl-parcelas-duplicata").append(tr);return true;},buscaDocFiscal:function(){dijit.byId("dl_terceiro_id_remetente").attr("value","");dijit.byId("dl_terceiro_id_destinatario").attr("value","");dijit.byId("dl_fn_doc_fiscal_numero").attr("value","");dijit.byId("dl_fn_doc_fiscal_data").attr("value","");financeiroDocumentoFiscal.gridBuscaDocFical();dijit.byId("dialogBuscaDocFiscal").show();},deletaDuplicata:function(){if(confirm("Você está preste a excluir definitivamente uma duplicata!\nDeseja continuar?")){identify=document.getElementById("fn_duplicata_id").value;objGeral.buscaAjax({url:baseUrl+"/financeiro/duplicata/delet/",data:{identify:identify},handle:"json",callback:function(_12){if(_12.status){objGeral.closeGenericDialog();financeiroDuplicata.atualizarGrid();objGeral.msgSucesso(_12.description[0].message);}else{objGeral.msgAlerta(_12.description[0].message);}}});}else{return false;}}});var financeiroDuplicata=new modulo.financeiro.duplicata();}