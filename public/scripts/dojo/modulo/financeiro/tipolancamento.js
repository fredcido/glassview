/*
	Copyright (c) 2004-2010, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["modulo.financeiro.tipolancamento"]){dojo._hasResource["modulo.financeiro.tipolancamento"]=true;dojo.require("modulo.padrao.geral");dojo.require("modulo.padrao.grid");dojo.provide("modulo.financeiro.tipolancamento");dojo.declare("modulo.financeiro.tipolancamento",[modulo.padrao.geral,modulo.padrao.grid],{treeView:null,constructor:function(){},initGrid:function(){objGeral.loading(true);financeiroTipoLancamento.gridHeader="#,"+objGeral.translate("Código")+","+objGeral.translate("Descrição")+","+objGeral.translate("Projeto")+","+objGeral.translate("Categoria")+","+objGeral.translate("Status");document.getElementById("gridFinanceiroTipoLancamento").style.height=objGrid.gridHeight+"px";financeiroTipoLancamento.grid=new dhtmlXGridObject("gridFinanceiroTipoLancamento");financeiroTipoLancamento.grid.setHeader(financeiroTipoLancamento.gridHeader);financeiroTipoLancamento.grid.attachHeader("#rspan,#text_filter,#text_filter,#select_filter,#select_filter,#select_filter");financeiroTipoLancamento.grid.setInitWidths(objGrid.idWidth+",200,*,320,320,100");financeiroTipoLancamento.grid.setColAlign("center,left,left,left,left,left");financeiroTipoLancamento.grid.setColTypes("ro,ro,ro,ro,ro,ro");financeiroTipoLancamento.grid.setColSorting("str,str,str,str,str,str");financeiroTipoLancamento.grid.setSkin(objGrid.theme);financeiroTipoLancamento.grid.enablePaging(true,objGrid.pagResults,objGrid.pagIndexes,"divpagFinanceiroTipoLancamentoGrid",true,"gridFinanceiroTipoLancamento");financeiroTipoLancamento.grid.attachFooter(objGrid.tituloTotal+",#cspan,#cspan,#cspan,#cspan,{#stat_count}");financeiroTipoLancamento.grid.attachEvent("onRowDblClicked",financeiroTipoLancamento.edit);financeiroTipoLancamento.grid.init();financeiroTipoLancamento.grid.load(baseUrl+"/financeiro/tipo-lancamento/list",dojo.hitch(objGeral,"loading",false),"json");},novo:function(){objGeral.createDialog("/financeiro/tipo-lancamento/form/",objGeral.translate("Tipo de Lançamento"));},edit:function(){if(!financeiroTipoLancamento.grid.getSelectedId()){objGeral.msgAlerta(objGeral.translate("Selecione o item para edição."));return false;}objGeral.createDialog("/financeiro/tipo-lancamento/edit/id/"+financeiroTipoLancamento.grid.getSelectedId(),objGeral.translate("Tipo de Lançamento"),dojo.hitch(this,"setReadOnly"));return true;},atualizarGrid:function(){objGeral.atualizarGrids([financeiroTipoLancamento.grid]);},organizar:function(){var _1=objGeral.createDialog("/financeiro/tipo-lancamento/organizar/",objGeral.translate("Organizar"));},buscaCategoriasProjeto:function(){var id=dijit.byId("projeto_id").get("value");objGeral.changeFilteringSelect("fn_categoria_id",baseUrl+"/financeiro/tipo-lancamento/categorias-por-projeto/id/",id);},carregarTiposLancamento:function(){var id=dijit.byId("fn_categoria_id").get("value");if(objGeral.empty(id)){return false;}this._initTree(id);return true;},_initTree:function(id){if(!objGeral.empty(this.treeView)){this.treeView.destroyRecursive(true);}objGeral.loading(true);var _2=new dojo.data.ItemFileWriteStore({url:baseUrl+"/financeiro/tipo-lancamento/tree/id/"+id,hierarchical:true});_2.fetch({onComplete:function(){objGeral.loading(false);}});var _3=new modulo.custom.ForestStoreModel({store:_2,query:{type:"root"},childrenAttrs:["children"]},"store");this.treeView=new modulo.custom.TreeMenu({model:_3,showRoot:false,persist:false,dragThreshold:8,betweenThreshold:5,dndController:"dijit.tree.dndSource",customIcons:false});dojo.connect(this.treeView,"_onItemChildrenChange",dojo.hitch(this,"changeOrder"));dojo.byId("tree-tipo-lancamento").appendChild(this.treeView.domNode);this.treeView.startup();},changeOrder:function(_4,_5){var _6=[];dojo.forEach(_5,function(_7){_6.push(_7.id[0]);});var _8=this;var _9={url:baseUrl+"/financeiro/tipo-lancamento/organizar-tipo-lancamento/",data:{pai:_4.root?null:_4.id,"filhos[]":_6},handle:"json",noload:true,callback:function(_a){if(!_a.status){objGeral.msgErro(_a.message);}}};objGeral.buscaAjax(_9);return true;},setReadOnly:function(){this.agrupador=dijit.byId("fn_tipo_lanc_agrupador").attr("value");if(this.agrupador==1){dijit.byId("fn_tipo_lanc_cod").attr("readOnly",true);dijit.byId("fn_tipo_lanc_cod").attr("value","");}else{dijit.byId("fn_tipo_lanc_cod").attr("readOnly",false);}}});var financeiroTipoLancamento=new modulo.financeiro.tipolancamento();}