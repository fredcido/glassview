/*
	Copyright (c) 2004-2010, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["modulo.almoxarifado.estoque"]){dojo._hasResource["modulo.almoxarifado.estoque"]=true;dojo.require("modulo.padrao.geral");dojo.require("modulo.padrao.grid");dojo.provide("modulo.almoxarifado.estoque");dojo.declare("modulo.almoxarifado.estoque",[modulo.padrao.geral,modulo.padrao.grid],{constructor:function(){},initGrid:function(){objGeral.loading(true);document.getElementById("gridAlmoxarifadoEstoque").style.height=objGrid.gridHeight+"px";almoxarifadoEstoque.grid=new dhtmlXGridObject("gridAlmoxarifadoEstoque");almoxarifadoEstoque.grid.setHeader("#,Produto,Tipo,Fluxo,Data,Quantidade,Valor unitário,Total");almoxarifadoEstoque.grid.attachHeader("#rspan,#text_filter,#select_filter,#select_filter,#text_filter,#numeric_filter,#text_filter,#text_filter");almoxarifadoEstoque.grid.setInitWidths(objGrid.idWidth+",*,200,200,150,150,200,200");almoxarifadoEstoque.grid.setColAlign("center,left,left,left,left,right,right,right");almoxarifadoEstoque.grid.setColTypes("ro,ro,ro,ro,ro,ro,ro,ro");almoxarifadoEstoque.grid.setColSorting("int,str,str,str,date,int,na,na");almoxarifadoEstoque.grid.setCustomSorting(dojo.hitch(objGeral,"sortCurrency"),6);almoxarifadoEstoque.grid.setCustomSorting(dojo.hitch(objGeral,"sortCurrency"),7);almoxarifadoEstoque.grid.setSkin(objGrid.theme);almoxarifadoEstoque.grid.enablePaging(true,objGrid.pagResults,objGrid.pagIndexes,"divpagAlmoxarifadoEstoqueGrid",true,"divpagAlmoxarifadoEstoque");almoxarifadoEstoque.grid.attachFooter(objGeral.translate("Movimentações")+",#cspan,#cspan,#cspan,#cspan,{#stat_count},"+objGeral.translate("Total R$")+",{#stat_total}");almoxarifadoEstoque.grid.attachEvent("onRowDblClicked",almoxarifadoEstoque.edit);almoxarifadoEstoque.grid.init();almoxarifadoEstoque.grid.load(baseUrl+"/almoxarifado/estoque/list",dojo.hitch(objGeral,"loading",false),"json");},novo:function(){objGeral.createDialog("/almoxarifado/estoque/form/","Movimentação");},visualizar:function(){if(!almoxarifadoEstoque.grid.getSelectedId()){objGeral.msgAlerta("Selecione o lançamento para visualizar.");return false;}objGeral.createDialog("/almoxarifado/estoque/visualizar/id/"+almoxarifadoEstoque.grid.getSelectedId(),"Visualização de lançamento");return true;},calculaTotal:function(){var _1=parseInt(dijit.byId("estoque_quantidade").get("value"));var _2=parseFloat(dijit.byId("estoque_valor_atual").get("value"));dijit.byId("estoque_valor_total").set("value",_2*_1);},atualizarGrid:function(){if(almoxarifadoEstoque.grid){objGeral.atualizarGrids([almoxarifadoEstoque.grid]);}},buscaProduto:function(){var _3=dijit.byId("produto_id");var id=_3.get("value");this.bloqueiaCamposMov(true);if(objGeral.empty(id)){return false;}var _4=this;var _5={url:baseUrl+"/almoxarifado/estoque/dados-produto/id/"+id,handle:"json",callback:function(_6){if(!_6.valid){_3.set("value","");}else{_4.bloqueiaCamposMov(false);dijit.byId("formAlmoxarifadoEstoque").setValues(_6.data);}},callbackError:function(){_3.set("value","");}};objGeral.buscaAjax(_5);return true;},bloqueiaCamposMov:function(_7){var _8=["estoque_valor_total","estoque_quantidade"];dijit.findWidgets(dojo.byId("fieldset-elementosmov")).forEach(function(_9){if(dojo.indexOf(_8,_9.get("id"))<0){_9.set("readOnly",_7);}_9.reset&&_9.reset();});},tipoMovimentacao:function(){var _a=dijit.byId("estoque_tipo").get("value");dijit.byId("estoque_quantidade").set("readOnly",objGeral.empty(_a));if(objGeral.empty(_a)){return false;}var _b=dijit.byId("produto_estoque_max").get("value");var _c=dijit.byId("produto_estoque_min").get("value");var _d=dijit.byId("estoque_qtde_anterior").get("value");var _e=null;if("E"==_a&&!objGeral.empty(_b)){_e=parseInt(_b)-parseInt(_d);}else{if("S"==_a&&!objGeral.empty(_c)){_e=parseInt(_d)-parseInt(_c);}}if(_e!=null&&_e<=0){dijit.byId("estoque_quantidade").set("value",0);_e=0;objGeral.msgAlerta("O estoque atual não permite realizar esta operação.");}if(_e!=null){dijit.byId("estoque_quantidade").constraints.max=_e;}dijit.byId("estoque_quantidade").focus();objGeral.setRequired("terceiro_id",("E"==_a));if("S"==_a){with(dijit.byId("terceiro_id")){set("readOnly",true);set("value","");}}return true;},ajustar:function(){if(!almoxarifadoEstoque.grid.getSelectedId()){objGeral.msgAlerta("Selecione o item para realizar o ajuste.");return false;}if((/A/).exec(almoxarifadoEstoque.grid.getSelectedId())){objGeral.msgAlerta("Um ajuste não pode ser feito em cima de outro.");return false;}objGeral.createDialog("/almoxarifado/estoque/ajuste/id/"+almoxarifadoEstoque.grid.getSelectedId(),"Ajuste",dojo.hitch(this,"tipoMovimentacao"));return true;}});var almoxarifadoEstoque=new modulo.almoxarifado.estoque();}