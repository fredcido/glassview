/*
	Copyright (c) 2004-2010, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["modulo.padrao.geral"]){dojo._hasResource["modulo.padrao.geral"]=true;dojo.provide("modulo.padrao.geral");dojo.declare("modulo.padrao.geral",[],{constructor:function(){},reqAjax:0,timeout:0,especReqAjax:new Array(),loading:function(_1){if(_1){this.reqAjax++;dojo.byId("loading").style.display="block";dojo.byId("loading_bkg").style.display="block";}else{this.reqAjax--;if(this.reqAjax<1){dojo.byId("loading").style.display="none";dojo.byId("loading_bkg").style.display="none";}}},fimCarregando:function(){dojo.fx.chain([dojo.fadeOut({node:"carregando_sistema",duration:1000,onEnd:function(){dojo.byId("carregando_sistema").style.display="none";}})]).play();},especLoading:function(_2,_3){if(this.empty(dojo.byId(_3))){return false;}if(this.empty(this.especReqAjax[_3])){this.especReqAjax[_3]=0;}if(_2){this.especReqAjax[_3]++;document.getElementById(_3).style.display="block";}else{this.especReqAjax[_3]--;if(this.especReqAjax[_3]<1){document.getElementById(_3).style.display="none";}}return true;},buscaAjax:function(_4,_5){if(!_4.noload){if(_5){this.especLoading(true,_5);}else{this.loading(true);}}if(_4.data&&_4.data!==undefined){dojo.xhrPost({url:escape(_4.url),content:_4.data,handleAs:_4.handle,form:_4.form,load:function(_6){if(_4.callback&&typeof (_4.callback)!==undefined){_4.callback(_6);}if(!_4.noload){if(_5){objGeral.especLoading(false,_5);}else{objGeral.loading(false);}}return _6;},error:function(_7){if(!_4.noMsg){if(_4.msg){objGeral.msgErro(_4.msg);}else{objGeral.msgErro(objGeral.translate("Erro ao executar operação"));}}if(!_4.noload){if(_5){objGeral.especLoading(false,_5);}else{objGeral.loading(false);}}if(_4.callbackError&&typeof (_4.callbackError)!==undefined){_4.callbackError(_7);}return _7;}});}else{dojo.xhrGet({url:escape(_4.url),handleAs:_4.handle,load:function(_8){if(_4.callback&&typeof (_4.callback)!==undefined){_4.callback(_8);}if(!_4.noload){if(_5){objGeral.especLoading(false,_5);}else{objGeral.loading(false);}}return _8;},error:function(_9,_a){if(!_4.noMsg){if(_4.msg){objGeral.msgErro(_4.msg);}else{objGeral.msgErro(objGeral.translate("Erro ao executar operação"));}}if(!_4.noload){if(_5){objGeral.especLoading(false,_5);}else{objGeral.loading(false);}}if(_4.callbackError&&typeof (_4.callbackError)!==undefined){_4.callbackError(_9);}objGeral.loading(false);}});}},msgErro:function(_b){this.showMsg(_b,"error");},msgAlerta:function(_c){this.showMsg(_c,"alert");},msgSucesso:function(_d){this.showMsg(_d,"confirm");},showMsg:function(_e,_f){var _10=dojo.byId("msgDiv");dojo.removeClass(_10,"error");dojo.removeClass(_10,"alert");dojo.removeClass(_10,"confirm");dojo.addClass(_10,_f);dojo.byId("msgDivText").innerHTML=_e;this.animateMsg(true);},animateMsg:function(_11){var _12=dojo.byId("msgDiv");var _13=dojo.byId("back_msg");if(_11){_13.style.display="block";dojo.fx.wipeIn({node:_12}).play();}else{_13.style.display="none";dojo.fx.wipeOut({node:_12}).play();}},empty:function(_14){var key;if((_14==="")||(_14===0)||(_14=="")||(_14==="0")||(_14==="null")||(_14=="NULL")||(_14==null)||(_14===false)||(_14=="undefined")||(_14==undefined)||(_14==="undefined")){return true;}if(typeof _14=="object"){for(key in _14){return false;}return true;}return false;},submit:function(_15,_16){var _17=dijit.byId(_15);if(this.validaForm(_17,_16)){this.loading(true);var _18=this;var _19={url:_17.get("action"),handleAs:"json",handle:function(){_18.loading(false);},load:function(_1a){_18.parseRetornoSubmit(_1a,_16);},error:function(_1b){_18.msgErro(objGeral.translate("Erro ao executar operação"));},form:dojo.byId(_15),timeout:_18.timeout};dojo.xhrPost(_19);}},submitIframe:function(_1c,_1d){if(this.validaForm(dijit.byId(_1c),_1d)){this.loading(true);dojo.io.iframe.send({form:_1c,handleAs:"json",handle:function(){objGeral.loading(false);},load:function(_1e){if(typeof _1e.error=="undefined"){objGeral.msgErro(objGeral.translate("Erro ao executar operação"));}else{this.parseRetornoSubmit(_1e,_1d);}},error:function(){objGeral.msgErro(objGeral.translate("Erro ao executar operação"));},timeout:this.timeout});}},parseRetornoSubmit:function(_1f,_20){var _21;this.createErrors(_1f.errors);if(!_1f.status){_21=!this.empty(_1f.description)?this.messages(_1f.description):objGeral.translate("Erro ao executar operação");this.msgErro(_21);}else{_21=!this.empty(_1f.description)?this.messages(_1f.description):objGeral.translate("Operação realizada com sucesso.");this.msgSucesso(_21);this.closeGenericDialog();_20.afterSubmit&&_20.afterSubmit(_1f);}},createErrors:function(_22){$("ul.errors").remove();for(index in _22){if(dijit.byId(index)){dijit.byId(index).set("state","Error");}var ul=$("<ul />");ul.addClass("errors");ul.attr("id","error_"+index);var _23=dijit.byId(index)?dijit.byId(index).domNode:$("#"+index);$(_23).closest("div.element").append(ul);for(m in _22[index]){var li=$("<li />").html(_22[index][m]);ul.append(li);}}},messages:function(_24){var ul="<ul class=\"messages\">";for(i in _24){ul+="<li>"+_24[i].message+"</li>";}ul+="</ul>";return ul;},execFunction:function(_25,_26){if(typeof _25=="function"){return _25(_26);}else{if(typeof _25=="string"){var fn=window[_25];if(typeof fn=="function"){return fn(_26);}else{return false;}}}return false;},validaForm:function(_27,_28){if(!_27.validate()){this.msgErro("Verifique todos os campos marcados antes de continuar.");return false;}else{if(_28.validate&&!_28.validate()){return false;}}return true;},changeFilteringSelect:function(_29,_2a,_2b,_2c){if(typeof _2c=="undefined"){dijit.byId(_29).attr("displayedValue","");}dijit.byId(_29).setDisabled(true);if(!_2b){return true;}this.loading(true);newRead=new dojo.data.ItemFileReadStore({url:_2a+_2b});newRead.fetch({onComplete:function(){objGeral.loading(false);dijit.byId(_29).setDisabled(false);dijit.byId(_29).focus();if(_2c!=undefined){dijit.byId(_29).attr("value",_2c);}}});dijit.byId(_29).store=newRead;dijit.byId(_29).setDisabled(false);},newWindow:function(_2d,_2e,_2f,_30){var _31;var _32=dojo.trim(_2e||"");if(_2f&&_30){var _33=(screen.width-_2f)/2;var _34=(screen.height-_30)/2;_31="toolbar=no,location=no,fullscreen=yes,status=no,menubar=no,scrollbars=yes,resizable=no,height="+_30+", width="+_2f+", top="+_34+", left="+_33;return window.open(_2d,_32,_31);}else{return window.open(_2d,_32);}},atualizarGrids:function(_35){dojo.map(_35,function(_36){if(_36.reload){_36.reload();}});},deleteRow:function(tr){dojo.forEach(dijit.findWidgets($(tr).html()),function(_37){_37.destroy();});$(tr).remove();return true;},truncate:function(str,_38){_38=_38||25;if(str.length>_38){str=str.substr(0,_38)+"...";}return str;},toCamelCase:function(str){return str.replace(/(\-[a-z])/g,function($1){return $1.toUpperCase().replace("-","");});},parseId:function(_39){var id=_39.replace(/^\/(.+?)\/$/gi,"$1");return id.replace("/","-");},openTab:function(url,_3a,_3b,_3c){if(this.empty(url)){this.msgErro("Opera&ccedil;&atilde;o inv&aacute;lida para abertura de aba.");return false;}var _3d=this.parseId(url);var id="tab"+_3d;var _3e=dijit.byId("contentCenter");var _3f;if(dijit.byId(id)){_3f=dijit.byId(id);}else{_3f=new dijit.layout.ContentPane({title:_3a,id:id,iconClass:_3c,closable:"true",href:baseUrl+url,onDownloadEnd:dojo.hitch(_3b),onDownloadError:function(){this.msgErro("Erro ao abrir tela.");}});_3e.addChild(_3f);}_3e.selectChild(_3f);return true;},novo:function(){},edit:function(){},requireModule:function(_40){var _41=_40.split("/");_41="/"+_41[1]+"/"+_41[2];var _42="objGeral.get"+_41.replace(/(?:^\w|[A-Z]|\b\w)/g,function(_43,_44){return _44==0?_43.toLowerCase():_43.toUpperCase();}).replace(/\/+/g,"");return eval(_42)?eval(_42+"();"):false;},afterSubmit:function(_45){this.atualizarGrid();},genericDialog:"genericDialog",createdDialogs:new Array(),createDialog:function(url,_46,_47){if(this.empty(url)){this.msgErro("Opera&ccedil;&atilde;o inv&aacute;lida para abertura de janela.");return false;}this.clearDialogs();var _48=new dijit.Dialog({title:_46,href:baseUrl+url,onDownloadEnd:function(){setTimeout(function(){objGeral.execFunction(_47);},50);},onDownloadError:function(){objGeral.msgErro("Opera&ccedil;&atilde;o inv&aacute;lida para abertura de janela.");},onHide:dojo.hitch(this,"closeGenericDialog")});_48._onKey=function(evt){if(evt.keyCode==dojo.keys.ESCAPE||evt.keyCode==dojo.keys.ENTER){dojo.stopEvent(evt);}};this.createdDialogs.push(_48);_48.show();return _48;},closeGenericDialog:function(){var _49=this.createdDialogs.length-1;if(!this.empty(this.createdDialogs[_49])){var _4a=this.createdDialogs[_49];_4a.hide();setTimeout(function(){if(!_4a.open){_4a.destroyRecursive();}},500);this.createdDialogs.splice(_49,1);}},getCurrentDialog:function(){var _4b=this.createdDialogs.length-1;if(!this.empty(this.createdDialogs[_4b])){return this.createdDialogs[_4b];}else{return null;}},clearDialogs:function(){var _4c=this;dojo.forEach(this.createdDialogs,function(_4d,_4e){if(!_4d.attr("open")){_4d.destroyRecursive();_4d.destroy();_4c.createdDialogs.splice(_4e,1);}});},centerDialog:function(){var _4f=this.createdDialogs.length-1;if(!this.empty(this.createdDialogs[_4f])){this.createdDialogs[_4f].layout();}},logout:function(){location.href=baseUrl+"/auth/logout";},setRequired:function(_50,_51){_50=typeof _50=="string"?dijit.byId(_50):_50;_51=_51?true:false;var id=_50.id;_50.set("required",_51);var _52=$("label[for="+id+"]");if(_51){_52.removeClass("optional").addClass("required").html(_52.html()+"*");}else{_52.removeClass("required").addClass("optional").html(_52.html().replace("*",""));}},sortCurrency:function(_53,_54,_55){_53=this.toFloat(_53);_54=this.toFloat(_54);if(_55=="asc"){return _53>_54?1:-1;}else{return _53>_54?-1:1;}},toFloat:function(num){num=num.toString().replace(/[^-0-9,]/g,"").replace(",",".");return parseFloat(num);},translate:function(str){return (this.empty(objTranslate[str])?str:objTranslate[str]);},formateDate:function(_56,_57){if(!_57){_57="yyyy-MM-dd";}return dojo.date.locale.format(_56,{datePattern:_57,selector:"date"});}});var objGeral=new modulo.padrao.geral();}