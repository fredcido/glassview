/*
	Copyright (c) 2004-2010, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["modulo.padrao.lembrete"]){dojo._hasResource["modulo.padrao.lembrete"]=true;dojo.require("modulo.padrao.geral");dojo.require("modulo.padrao.grid");dojo.provide("modulo.padrao.lembrete");dojo.declare("modulo.padrao.lembrete",[modulo.padrao.geral,modulo.padrao.grid],{container:null,constructor:function(){},initGrid:function(){objGeral.loading(true);document.getElementById("gridDefaultLembrete").style.height=objGrid.gridHeight+"px";defaultLembrete.grid=new dhtmlXGridObject("gridDefaultLembrete");defaultLembrete.grid.setHeader("#,Título,Lembrete,Fluxo,Nível,Data Prevista");defaultLembrete.grid.attachHeader("#rspan,#text_filter,#text_filter,#select_filter,#select_filter,#text_filter");defaultLembrete.grid.setInitWidths(objGrid.idWidth+",320,*,200,200,150");defaultLembrete.grid.setColAlign("center,left,left,left,left,left");defaultLembrete.grid.setColTypes("ro,ro,ro,ro,ro,ro");defaultLembrete.grid.setColSorting("str,str,str,str,str,str");defaultLembrete.grid.setSkin(objGrid.theme);defaultLembrete.grid.enablePaging(true,objGrid.pagResults,objGrid.pagIndexes,"divpagDefaultLembreteGrid",true,"gridDefaultLembrete");defaultLembrete.grid.attachFooter(objGrid.tituloTotal+",#cspan,#cspan,#cspan,#cspan,{#stat_count}");defaultLembrete.grid.attachEvent("onRowDblClicked",defaultLembrete.edit);defaultLembrete.grid.init();defaultLembrete.grid.load(baseUrl+"/default/lembrete/list",dojo.hitch(objGeral,"loading",false),"json");},novo:function(){objGeral.createDialog("/default/lembrete/form/",objGeral.translate("Lembrete"));},edit:function(){if(!defaultLembrete.grid.getSelectedId()){objGeral.msgAlerta(objGeral.translate("Selecione o item para edição."));return false;}var _1=defaultLembrete.grid.getSelectedId().replace(/[0-9]/g,"");if(_1=="R"){objGeral.msgAlerta(objGeral.translate("Lembrete recebido, não é possível editar."));return false;}var id=defaultLembrete.grid.getSelectedId().replace(/[^0-9]/g,"");objGeral.createDialog("/default/lembrete/edit/id/"+id,objGeral.translate("Lembrete"));return true;},atualizarGrid:function(){objGeral.atualizarGrids([defaultLembrete.grid]);},validate:function(){var _2=["usuarios","perfis","nivel"];var _3=dojo.some(_2,function(_4){return dojo.some(dojo.byId(_4).options,function(_5){return _5.selected;});});if(_3){return true;}objGeral.msgErro(objGeral.translate("Selecione algum destino para o lembrete"));dijit.byId("tabs-lembrete").selectChild("tab-destino");return false;},buscaLembretes:function(){if(objGeral.empty(objAuth)){return false;}dojo.xhrPost({url:baseUrl+"/default/lembrete/busca-lembretes/",handleAs:"json",load:function(_6){if(!objGeral.empty(_6)){defaultLembrete.showLembretes(_6);}}});return true;},showLembretes:function(_7){if($("#lembrete-container")){$("#lembrete-container").remove();}container=$("<div />").attr("id","lembrete-container").appendTo($("body"));dojo.forEach(_7,function(_8){var _9=$("<div />").addClass("lembrete-item").hide();var _a=$("<div />").addClass("lembrete-titulo");var _b=$("<span />").addClass("icon-toolbar-cancel");var _c=$("<div />").addClass("lembrete-content");var _d=$("<div />").addClass("lembrete-bottom");if(_8.lembrete_nivel==0){_9.addClass("urgente");}_9.attr("id",_8.lembrete_id);_b.click(dojo.hitch(defaultLembrete,"removeLembreteItem",_9));var h2=$("<h2 />").html(objGeral.translate("Lembrete"));h2.prepend($("<span />").addClass("icon-toolbar-email"));var _e=objGeral.empty(_8.usuario)?objGeral.translate("Sistema"):_8.usuario;_a.append(h2);_a.append(_b);_c.append($("<p />").html("<b>"+objGeral.translate("Título")+": </b>"+objGeral.truncate(_8.lembrete_titulo)));_c.append($("<p />").html("<b>"+objGeral.translate("De")+": </b>"+objGeral.truncate(_e)));_c.append($("<br />"));_c.append($("<p />").html("<i>\""+objGeral.truncate(_8.lembrete_msg,30)+"\"</i>"));_d.html(objGeral.translate("LER"));_d.click(dojo.hitch(defaultLembrete,"abrirLembrete",_9));_9.append(_a);_9.append(_c);_9.append(_d);_9.slideDown("slow");container.append(_9);window.setTimeout(dojo.hitch(defaultLembrete,"removeLembreteItem",_9),30*1000);});},abrirLembrete:function(_f){this.lerLembrete(_f.attr("id"));this.removeLembreteItem(_f);},lerLembrete:function(id){objGeral.createDialog("/default/lembrete/detalha/id/"+id,objGeral.translate("Lembrete"));},removeLembreteItem:function(_10){_10.slideUp("slow",function(){_10.remove();defaultLembrete.hideContainer();});},hideContainer:function(){if($("#lembrete-container div.lembrete-item").length<1){$("#lembrete-container").remove();}},detalhaLembreteGrid:function(){if(!defaultLembrete.grid.getSelectedId()){objGeral.msgAlerta(objGeral.translate("Selecione o item para detalhar."));return false;}var _11=defaultLembrete.grid.getSelectedId().replace(/[0-9]/g,"");if(_11=="E"){objGeral.msgAlerta(objGeral.translate("Lembrete enviado, não é possível detalhar."));return false;}var id=defaultLembrete.grid.getSelectedId().replace(/[^0-9]/g,"");this.lerLembrete(id);return true;},mudarStatus:function(id){dijit.byId("buttonbaixalembrete").setDisabled(true);var obj={url:baseUrl+"/default/lembrete/mudar-status/",data:{id:id},handle:"json",callback:function(_12){if(!_12.status){objGeral.msgErro(objGeral.translate("Erro ao executar operação"));dijit.byId("buttonbaixalembrete").setDisabled(false);}else{objGeral.closeGenericDialog();}}};objGeral.buscaAjax(obj);}});var defaultLembrete=new modulo.padrao.lembrete();}