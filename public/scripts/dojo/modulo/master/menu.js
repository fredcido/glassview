/*
	Copyright (c) 2004-2010, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["modulo.master.menu"]){dojo._hasResource["modulo.master.menu"]=true;dojo.require("modulo.padrao.geral");dojo.require("modulo.padrao.grid");dojo.provide("modulo.master.menu");dojo.declare("modulo.master.menu",[modulo.padrao.geral,modulo.padrao.grid],{treeView:null,menuChanged:false,constructor:function(){},initGrid:function(){objGeral.loading(true);masterMenu.gridHeader="#,"+objGeral.translate("Label")+","+objGeral.translate("Menu Pai")+","+objGeral.translate("Tela")+","+objGeral.translate("Tipo");document.getElementById("gridMasterMenu").style.height=objGrid.gridHeight+"px";masterMenu.grid=new dhtmlXGridObject("gridMasterMenu");masterMenu.grid.setHeader(masterMenu.gridHeader);masterMenu.grid.attachHeader("#rspan,#text_filter,#select_filter,#select_filter,#select_filter");masterMenu.grid.setInitWidths(objGrid.idWidth+",*,220,220,170");masterMenu.grid.setColAlign("center,left,left,left,left");masterMenu.grid.setColTypes("ro,ro,ro,ro,ro");masterMenu.grid.setColSorting("str,str,str,str,str");masterMenu.grid.setSkin(objGrid.theme);masterMenu.grid.enablePaging(true,objGrid.pagResults,objGrid.pagIndexes,"divpagMasterMenuGrid",true,"divpagMasterMenu");masterMenu.grid.attachFooter(objGrid.tituloTotal+",#cspan,#cspan,#cspan,{#stat_count}");masterMenu.grid.attachEvent("onRowDblClicked",masterMenu.edit);masterMenu.grid.init();masterMenu.grid.load(baseUrl+"/master/menu/list/",dojo.hitch(objGeral,"loading",false),"json");},novo:function(){objGeral.createDialog("/master/menu/form/",objGeral.translate("Menu"));},edit:function(){if(!masterMenu.grid.getSelectedId()){objGeral.msgAlerta(objGeral.translate("Selecione o item para edição."));return false;}objGeral.createDialog("/master/menu/edit/id/"+masterMenu.grid.getSelectedId(),objGeral.translate("Menu"));return true;},atualizarGrid:function(){objGeral.atualizarGrids([masterMenu.grid]);},organizar:function(){var _1=objGeral.createDialog("/master/menu/organizar/",objGeral.translate("Organizar"),dojo.hitch(this,"loadTreeMenu"));dojo.connect(_1,"onHide",dojo.hitch(this,"reloadMenu"));},reloadMenu:function(){if(!this.menuChanged||!confirm(objGeral.translate("Deseja recarregar o menu agora?"))){return false;}history.go(0);return true;},loadTreeMenu:function(){objGeral.loading(true);var _2=new dojo.data.ItemFileWriteStore({url:baseUrl+"/master/menu/tree/",hierarchical:true});_2.fetch({onComplete:function(){objGeral.loading(false);}});var _3=new modulo.custom.ForestStoreModel({store:_2,query:{type:"root"},childrenAttrs:["children"]},"store");this.treeView=new modulo.custom.TreeMenu({model:_3,showRoot:false,persist:false,dragThreshold:8,betweenThreshold:5,dndController:"dijit.tree.dndSource"});dojo.connect(this.treeView,"_onItemChildrenChange",dojo.hitch(this,"changeOrder"));dojo.byId("tree-menu").appendChild(this.treeView.domNode);this.treeView.startup();},changeOrder:function(_4,_5){var _6=[];dojo.forEach(_5,function(_7){_6.push(_7.id[0]);});var _8=this;var _9={url:baseUrl+"/master/menu/organizar-menu/",data:{pai:_4.root?null:_4.id,"filhos[]":_6},handle:"json",callback:function(_a){if(!_a.status){objGeral.msgErro(_a.message);}else{_8.menuChanged=true;}}};objGeral.buscaAjax(_9);return true;}});var masterMenu=new modulo.master.menu();}