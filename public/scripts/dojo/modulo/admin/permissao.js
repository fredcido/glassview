/*
	Copyright (c) 2004-2010, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["modulo.admin.permissao"]){dojo._hasResource["modulo.admin.permissao"]=true;dojo.require("modulo.padrao.geral");dojo.require("modulo.padrao.grid");dojo.provide("modulo.admin.permissao");dojo.declare("modulo.admin.permissao",[modulo.padrao.geral,modulo.padrao.grid],{treeView:null,constructor:function(){},carregaPermissoes:function(){var _1=dijit.byId("perfil_id").get("value");if(objGeral.empty(_1)){return false;}this._initTree(_1);return true;},_initTree:function(_2){if(!objGeral.empty(this.treeView)){this.treeView.destroyRecursive(true);}objGeral.loading(true);var _3=new dojo.data.ItemFileReadStore({url:baseUrl+"/admin/permissao/itens/id/"+_2,hierarchical:true});_3.fetch({onComplete:function(){objGeral.loading(false);}});var _4=new dijit.tree.ForestStoreModel({store:_3,query:{type:"root"},childrenAttrs:["children"]},"store");this.treeView=new modulo.custom.ChkTree({model:_4,showRoot:false,persist:false});dojo.byId("tree-permissoes").appendChild(this.treeView.domNode);dojo.connect(this.treeView,"onNodeUnchecked",dojo.hitch(this,"removePermissao"));dojo.connect(this.treeView,"onNodeChecked",dojo.hitch(this,"addPermissao"));this.treeView.startup();},removePermissao:function(_5){var id=_5.getId();var _6=dijit.byId("perfil_id").get("value");var _7={url:baseUrl+"/admin/permissao/delete/",handle:"json",data:{acao_id:id,perfil_id:_6},noload:true,callback:function(_8){if(!_8.status){_5.markCheck();objGeral.msgErro(_8.message);}}};objGeral.buscaAjax(_7);},addPermissao:function(_9){var id=_9.getId();var _a=dijit.byId("perfil_id").get("value");var _b={url:baseUrl+"/admin/permissao/adicionar/",data:{acao_id:id,perfil_id:_a},handle:"json",noload:true,callback:function(_c){if(!_c.status){_9.markCheck();objGeral.msgErro(_c.message);}}};objGeral.buscaAjax(_b);}});var adminPermissao=new modulo.admin.permissao();}